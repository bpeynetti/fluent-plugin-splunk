machine:
  services:
    - docker

dependencies:
  cache_directories:
    - "~/docker"
  override:
    - bundle install
    - docker info
    - ./docker.sh login
    - ./docker.sh load_or_pull 6.0.14
    - ./docker.sh load_or_pull 6.1.13
    - ./docker.sh load_or_pull 6.2.12
    - ./docker.sh load_or_pull 6.3.9
    - ./docker.sh load_or_pull 6.4.6
    - ./docker.sh load_or_pull 6.5.2

test:
  override:
    - ./docker.sh run 6.0.14; sleep 20
    - SPLUNK_VERSION=6.0.14 bundle exec rake coverage
    - ./docker.sh stop 6.0.14
    - ./docker.sh run 6.1.13; sleep 20
    - SPLUNK_VERSION=6.1.13 bundle exec rake coverage
    - ./docker.sh stop 6.1.13
    - ./docker.sh run 6.2.12; sleep 20
    - SPLUNK_VERSION=6.2.12 bundle exec rake coverage
    - ./docker.sh stop 6.2.12
    - ./docker.sh run 6.3.9; sleep 20
    - SPLUNK_VERSION=6.3.9 bundle exec rake coverage
    - ./docker.sh stop 6.2.9
    - ./docker.sh run 6.4.6; sleep 20
    - SPLUNK_VERSION=6.4.6 bundle exec rake coverage
    - ./docker.sh stop 6.4.6
    - ./docker.sh run 6.5.2; sleep 20
    - SPLUNK_VERSION=6.5.2 bundle exec rake coverage
    - ./docker.sh stop 6.5.2
